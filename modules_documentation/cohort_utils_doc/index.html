<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">

    
    <title>Cohort utils - WP1</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="../..">WP1</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../dataflow/">Overview</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../liveraim_data_warehouse_specifications/">LIVERAIM Data Warehouse Specifications</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules documentation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../file_reading_utils_doc/">File Reading utils</a>
</li>

                        
                            
<li >
    <a href="../data_processing_utils_doc/">Preprocessing utils</a>
</li>

                        
                            
<li class="active">
    <a href="./">Cohort utils</a>
</li>

                        
                            
<li >
    <a href="../qc_checks_utils_doc/">Quality Control utils</a>
</li>

                        
                            
<li >
    <a href="../file_exporting_utils_doc/">File Exporting utils</a>
</li>

                        
                            
<li >
    <a href="../sql_exporting_utils_doc/">SQL Exporting utils</a>
</li>

                        
                            
<li >
    <a href="../configuration_module/">Configuration module</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../quick_start_guide/">Quick Start Guide</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../data_processing_utils_doc/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../qc_checks_utils_doc/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#cohorts_utils-documentation">cohorts_utils Documentation</a></li>
            <li class="second-level"><a href="#overview">Overview</a></li>
                
            <li class="second-level"><a href="#general-sturcture">General Sturcture</a></li>
                
            <li class="second-level"><a href="#functions-and-classes">Functions and Classes</a></li>
                
                <li class="third-level"><a href="#functions">Functions</a></li>
                <li class="third-level"><a href="#merge_cohorts-function">merge_cohorts function</a></li>
                <li class="third-level"><a href="#classes">Classes</a></li>
                <li class="third-level"><a href="#class-cohort">Class Cohort</a></li>
            <li class="second-level"><a href="#general-operation">General Operation</a></li>
                
            <li class="second-level"><a href="#usage-example">Usage Example</a></li>
                
            <li class="second-level"><a href="#usage-in-main-execution">Usage in main execution</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="cohorts_utils-documentation"><code>cohorts_utils</code> Documentation<a class="headerlink" href="#cohorts_utils-documentation" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>En este módulo se define la clase <code>Cohort</code>, que centralliza el proceso de homogeneización de los datos de las distintas cohortes en un formato comón, determinado por la configuration data. </p>
<p>...</p>
<h2 id="general-sturcture">General Sturcture<a class="headerlink" href="#general-sturcture" title="Permanent link">&para;</a></h2>
<p>The module consists of the following key components:</p>
<ul>
<li><strong>Funciones encargadas de la transformación y homogeneización</strong> de las databases (en formato <code>pd.DataFrame</code>) de cada una de las cohortes. </li>
<li><strong>Clase <code>Cohort</code></strong>: esta clase centraliza los datos de una cohorte (tanto la databse en crudo, los datos de configuración etc.), así como el proceso de homogeneización de los datos y, finalmente, la distribución de las variables en cada uno de los paneles. Cabe destacar que los argumentos que necesita <code>Cohort</code> para inicializarse, son el producto del preprocesamiento llevado a cabo por <code>DataPreprocessor</code>. </li>
<li><strong>Funciones auxiliares</strong> usadas por cohort para inicializar atributos. </li>
</ul>
<h2 id="functions-and-classes">Functions and Classes<a class="headerlink" href="#functions-and-classes" title="Permanent link">&para;</a></h2>
<p>In this sections are described the classes and functions defined in the module: </p>
<h3 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong><code>manage_string_type(df: pd.DataFrame, var: str) -&gt; None</code></strong>
    Converts the specified column <code>var</code> in the DataFrame <code>df</code> to string type.</p>
<ul>
<li>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>df</code> (pd.DataFrame): The DataFrame containing the data.</li>
<li><code>var</code> (str): The name of the column to convert to string.</li>
</ul>
</li>
<li>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>None</code>: This function does not return any value. It modifies the DataFrame in place.</li>
</ul>
</li>
<li>
<p><strong>Logs</strong></p>
<ul>
<li>If a <strong>ValueError</strong> occurs during conversion (e.g., invalid data), an error is logged.</li>
<li>If a <strong>KeyError</strong> occurs (i.e., the column does not exist in the DataFrame), an error is logged.
<br><br></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>manage_category_type(...) -&gt; None</code></strong>
    Converts the specified column <code>var</code> in the DataFrame <code>df</code> to the category data type, using a mapping provided in <code>level_data_json</code>.</p>
<ul>
<li>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>var</code> (str): The name of the column to convert to category.</li>
<li><code>df</code> (pd.DataFrame): The DataFrame containing the data.</li>
<li><code>level_data_json</code> (dict): A dictionary that contains the mapping (<code>map</code>) for the conversion of the column to category.</li>
</ul>
</li>
<li>
<p><strong>Returns</strong>:    </p>
<ul>
<li><code>None</code>: This function does not return any value. It modifies the DataFrame in place.</li>
</ul>
</li>
<li>
<p><strong>Logs</strong></p>
<ul>
<li>If a <strong>ValueError</strong> occurs during conversion (e.g., invalid data), an error is logged.</li>
<li>If a <strong>KeyError</strong> occurs (e.g., the column does not exist in the DataFrame), an error is logged.</li>
<li>If any other unexpected <strong>Exception</strong> occurs, an error is logged.
<br><br></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>manage_numerical_type(var: str,</code>
  <code>data_type: Literal['int64', 'float64'],</code>
  <code>df: pd.DataFrame,</code>
  <code>var_data_json: dict) -&gt; None</code></strong></p>
<p>Converts the specified column <code>var</code> in the DataFrame <code>df</code> to a numerical data type (int or float), and applies a conversion factor if available.</p>
<ul>
<li>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>var</code> (str): The name of the column to convert.</li>
<li><code>data_type</code> (Literal['int64', 'float64']): The target data type to convert the column to (<code>int64</code> or <code>float64</code>).</li>
<li><code>df</code> (pd.DataFrame): The DataFrame containing the data.</li>
<li><code>var_data_json</code> (dict): A dictionary containing additional information for the conversion, specifically the conversion factor.</li>
</ul>
</li>
<li>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>None</code>: This function does not return any value. It modifies the DataFrame in place.</li>
</ul>
</li>
<li>
<p><strong>Logs</strong>:</p>
<ul>
<li>If a <strong>ValueError</strong> occurs during conversion (e.g., invalid data), an error is logged.</li>
<li>If a <strong>KeyError</strong> occurs (e.g., the column does not exist in the DataFrame), an error is logged.</li>
<li>If any other unexpected <strong>Exception</strong> occurs, an error is logged: `"An error occurred while converting variable '%s' to data type '%s' <br />
<br><br></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>manage_datetime_type(var: str, data_type: str, df: pd.DataFrame) -&gt; None</code></strong>
    Converts the specified column <code>var</code> in the DataFrame <code>df</code> to a datetime format, normalizing the date (removing time components).</p>
<ul>
<li>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>var</code> (str): The name of the column to convert to datetime.</li>
<li><code>data_type</code> (str): The target data type (used in logging) to convert the column to.</li>
<li><code>df</code> (pd.DataFrame): The DataFrame containing the data.</li>
</ul>
</li>
<li>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>None</code>: This function does not return any value. It modifies the DataFrame in place.</li>
</ul>
</li>
<li>
<p><strong>Logs</strong>:</p>
<ul>
<li>If a <strong>ValueError</strong> occurs during conversion (e.g., invalid datetime format), an error is logged.</li>
<li>If a <strong>KeyError</strong> occurs (e.g., the column does not exist in the DataFrame), an error is logged.</li>
<li>If any other unexpected <strong>Exception</strong> occurs, an error is logged.</li>
</ul>
</li>
<li>
<p><strong>Notes</strong></p>
<ul>
<li>The function uses <code>pd.to_datetime</code> to convert the column to datetime format and normalizes the date, setting the time to midnight (00:00:00).</li>
<li>In case of errors, detailed log messages are recorded with information about the variable and the type of error that occurred.
<br><br></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>set_liveraim_format(df: pd.DataFrame, var_data_json: dict, level_data_json: dict) -&gt; None</code></strong>
    Converts the columns (variables) in the DataFrame <code>df</code> to the proper format for liveraim. The format (data types, categories codification, etc.) is configured in <code>var_data_json</code> and <code>level_data_json</code> dictionaries.</p>
<ul>
<li>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>df</code> (pd.DataFrame): The DataFrame containing the data to be transformed.</li>
<li><code>var_data_json</code> (dict): Contains relevant information about the variables, used to transform the data into a common format.</li>
<li><code>level_data_json</code> (dict): Contains information about categorical variables, their levels, and the description codification of each level.</li>
</ul>
</li>
<li>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>None</code>: This function does not return any value. It modifies the DataFrame in place.</li>
</ul>
</li>
<li>
<p><strong>Logs</strong></p>
<ul>
<li>Logs an info message when the data formatting process begins.</li>
<li>Logs a warning if the variables in the DataFrame are not a subset of the variables described in <code>var_data_json</code> or <code>level_data_json</code>.</li>
<li>Uses the appropriate conversion function (<code>manage_category_type</code>, <code>manage_datetime_type</code>, <code>manage_numerical_type</code>, <code>manage_string_type</code>) based on the <code>data_type</code> of each variable in the DataFrame. 
<br><br></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>type_converter(value, data_type: str, dictionary: dict) -&gt; any</code></strong>
    Converts a value to a specified data type using a provided converter map.</p>
<ul>
<li>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>value</code> (any): The value to convert.</li>
<li><code>data_type</code> (str): The target data type (e.g., 'int', 'float', 'str').</li>
<li><code>dictionary</code> (dict): A dictionary mapping data type strings to conversion functions.</li>
</ul>
</li>
<li>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>any</code>: The converted value.</li>
</ul>
</li>
<li>
<p><strong>Logs</strong></p>
<ul>
<li>If an <strong>Exception</strong> occurs during the conversion process, an error is logged with details about the value, target data type, and the error itself. The program will then exit.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>levels_data_to_json(...) -&gt; dict</code></strong>
    Converts a DataFrame containing metadata about categorical variable levels into a dictionary and saves it as a JSON file if a path is provided. This dictionary will be used as a lighter object to format the variables.</p>
<ul>
<li>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>var_column</code> (str): Column name for the variable name.</li>
<li><code>original_var_column</code> (str): Column name for the original variable name.</li>
<li><code>original_code_column</code> (str): Column name for the original code value.</li>
<li><code>common_code_column</code> (str): Column name for the common code value.</li>
<li><code>description_column</code> (str): Column name for the description.</li>
<li><code>original_data_type_column</code> (str): Column name for the original data type.</li>
<li><code>xlsx_file</code> (str, optional): Path to the Excel file to read the DataFrame from. Default is <code>None</code>.</li>
<li><code>df</code> (pd.DataFrame, optional): DataFrame containing the data. If <code>None</code>, the <code>xlsx_file</code> is used. Default is <code>None</code>.</li>
<li><code>final_path</code> (str, optional): Path to save the JSON file. Default is <code>None</code>.</li>
</ul>
</li>
<li>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>dict</code>: Dictionary containing the converted data.</li>
</ul>
</li>
<li>
<p><strong>Logs</strong></p>
<ul>
<li>Logs an error if the Excel file is not found (<code>FileNotFoundError</code>), if there's an issue with the format (<code>ValueError</code>), or if an unexpected exception occurs while reading the Excel file.</li>
<li>During the dictionary creation process, no specific logs are recorded, but the function handles type conversion using the <code>type_converter</code> function and logs errors accordingly.</li>
<li>If a JSON file is saved, a confirmation message is printed after saving the file.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="merge_cohorts-function"><code>merge_cohorts</code> function<a class="headerlink" href="#merge_cohorts-function" title="Permanent link">&para;</a></h3>
<h3 id="classes">Classes<a class="headerlink" href="#classes" title="Permanent link">&para;</a></h3>
<h3 id="class-cohort">Class <code>Cohort</code><a class="headerlink" href="#class-cohort" title="Permanent link">&para;</a></h3>
<h4 id="attributes">Attributes<a class="headerlink" href="#attributes" title="Permanent link">&para;</a></h4>
<h4 id="methods">Methods<a class="headerlink" href="#methods" title="Permanent link">&para;</a></h4>
<h4 id="logs">Logs<a class="headerlink" href="#logs" title="Permanent link">&para;</a></h4>
<h2 id="general-operation">General Operation<a class="headerlink" href="#general-operation" title="Permanent link">&para;</a></h2>
<h2 id="usage-example">Usage Example<a class="headerlink" href="#usage-example" title="Permanent link">&para;</a></h2>
<h2 id="usage-in-main-execution">Usage in main execution<a class="headerlink" href="#usage-in-main-execution" title="Permanent link">&para;</a></h2></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = "../.."</script>
    
    <script src="../../js/base.js"></script>
    <script src="../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
